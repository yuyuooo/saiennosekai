<div class="container mb-5">
  <div class="row">
    <div class="col-lg-4 col-xl-4 diary_container">
      <%=  render 'diaries/form' %>
    </div>
    <div class="col-md-10 mx-auto col-lg-5 offset-lg-1 col-xl-4 offset-xl-1 mb-5">
      <% unless @crop_folder.user == current_user %>
        <h5 class="mb-5 diary_title"><%= @crop_folder.crop_name %>の栽培日記</h5>
      <% end %>
      <h5 class="mb-5 diary_crop_name"><%= @crop_folder.crop_name %>の栽培日記</h5>
      <% if @crop_folder.user == current_user %>
        <div class="new_diary_button mb-4">
          <%= link_to new_crop_folder_diary_path(@crop_folder), class: "btn btn-info" do %>
            <i class="fas fa-seedling"></i> 追加
          <% end %>
        </div>
      <% end %>
      <% if @crop_folder.diaries.length > 0 %>
        <% @crop_folder.diaries.first(3).each do |diary| %>
          <div class="diary_folder">
            <div class="diary_box">
              <table class="table table-borderless">
                <span class="masking-tape">
                </span>
                <tr>
                  <td><%= diary.diary_date %></td>
                  <td>天気：<%= diary.weather %></td>
                  <td><% if diary.user == current_user %>
                        <%= link_to "削除", crop_folder_diary_path(@crop_folder, diary), method: :delete, class: "btn btn-danger btn-sm" %>
                      <% end %>
                  </td>
                </tr>
              </table>
              <div class="crop_image">
                <%= image_tag diary.get_crop_image(300,200) %>
              </div>
              <p class="daiary_title"><%= diary.title %></p>
              <p class="long_text"><%= diary.body %></p>
            </div>
          </div>
        <% end %>
        <% if @crop_folder.diaries.length > 3 %>
          <details>
            <summary class="mb-5">全ての日記を表示</summary>
            <% @crop_folder.diaries.offset(3).each do |diary| %>
              <div class="diary_box">
                <table class="table table-borderless">
                  <span class="masking-tape">
                  </span>
                  <tr>
                    <td><%= diary.diary_date %></td>
                    <td>天気：<%= diary.weather %></td>
                    <td><% if diary.user == current_user %>
                          <%= link_to "削除", crop_folder_diary_path(@crop_folder, diary), method: :delete, class: "btn btn-danger btn-sm" %>
                        <% end %>
                    </td>
                  </tr>
                </table>
                <div class="crop_image">
                  <%= image_tag diary.get_crop_image(300,200) %>
                </div>
                <p class="daiary_title"><%= diary.title %></p>
                <p class="long_text"><%= diary.body %></p>
              </div>
            <% end %>
          </details>
        <% end %>
      <% else %>
        <p class="text-center">=== 登録された栽培日記はありません ===</p>
      <% end %>
    </div>
    <div class="col-md-8 mx-auto col-lg-3">
     <div>
      <p>コメント件数：<%= @crop_folder.crop_comments.count %></p>
      <% @crop_folder.crop_comments.each do |crop_comment| %>
      <div class="comment_user">
        <%= image_tag crop_comment.user.get_profile_image(30,30), class: "user_profile_image" %>
        <%= link_to "#{crop_comment.user.name}", user_about_path(crop_comment.user) %>
      </div>
        <p class="mb-0"><%= crop_comment.comment %></p>
        <p>(<%= crop_comment.created_at.strftime('%Y-%m-%d') %>)</p>
      <% end %>
      </div>
      <div>
      <%= render 'layouts/errors', obj: @crop_comment %>
      <%= form_with model: [@crop_folder, @crop_comment], url: crop_folder_crop_comments_path(@crop_folder.id) do |f| %>
        <%= f.text_area :comment, rows: '3', placeholder: "コメントをここに入力",class: 'form-control' %>
        <%= f.submit "コメントを送信", class: 'btn btn-submit mb-4' %>
      <% end %>
      </div>
    </div>
  </div>
</div>
